summary: Kdump tests
discover:
  - name: client-setup
    how: fmf
    test:
     - setup/kdump
    where:
      - client
  - name: server-setup
    how: fmf
    test:
     - setup/nfs_server
    where:
      - server
  - name: client-test
    how: fmf
    test:
     - /tests/client
    where:
      - client
  - name: server-test
    how: fmf
    test:
     - /tests/server
    where:
      - server

provision:
   - name: server
     how: virtual
     image: fedora:40

   - name: client
     how: virtual
     image: fedora:40

prepare:
  - name: Install built RPM
    how: install
    package:
      - "$KDUMP_UTILS_RPM"
    where:
      - client

  - name: permit_root
    how: shell
    script:
      - echo root:kdump | chpasswd
    where:
      - client
      - server

execute:
    how: tmt

adjust:
  - when: custom_mirror is defined
    prepare+:
      - how: shell
        script:
          - sed -e 's/^metalink=/#metalink=/g' -e 's|^#baseurl=http://download.example/pub/fedora/linux|baseurl=$@custom_mirror|g' -i.bak /etc/yum.repos.d/*.repo
